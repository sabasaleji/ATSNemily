┌─────────────────────────────────────────────────────────────────────────────────┐
│                           BLOG CREATION WORKFLOW                               │
│                        (With Proper Context Usage)                             │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌─────────────────┐
    │   USER CLICKS   │
    │ "Generate Blog" │
    │   (Frontend)    │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  API CALL TO    │
    │ /api/blogs/     │
    │ generate        │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │ BlogWritingAgent│
    │ .generate_blogs │
    │ _for_user()     │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │   LANGGRAPH     │
    │   WORKFLOW      │
    │   EXECUTION     │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  STEP 1: FETCH  │
    │  USER PROFILE   │
    │  FROM DATABASE  │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  STEP 2: FETCH  │
    │  WORDPRESS      │
    │  SITES          │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  STEP 3: BUILD  │
    │  GENERATION     │
    │  CONTEXT        │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  STEP 4: CALL   │
    │  OPENAI API     │
    │  WITH CONTEXT   │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  STEP 5: SAVE   │
    │  BLOG TO        │
    │  DATABASE       │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  STEP 6: RETURN │
    │  RESULT TO      │
    │  FRONTEND       │
    └─────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                           CONTEXT DATA FLOW                                    │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌─────────────────┐
    │   DATABASE      │
    │   profiles      │
    │   table         │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  EXTRACT USER   │
    │  PROFILE DATA   │
    │  • Business Name│
    │  • Industry     │
    │  • Target Audience│
    │  • Content Themes│
    │  • Brand Voice  │
    │  • Products/Services│
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  COMBINE WITH   │
    │  WORDPRESS SITE │
    │  INFORMATION    │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  BUILD FINAL    │
    │  GENERATION     │
    │  CONTEXT        │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  SEND TO OPENAI │
    │  API WITH FULL  │
    │  BUSINESS CONTEXT│
    └─────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                           ERROR HANDLING FLOW                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌─────────────────┐
    │  OPENAI API     │
    │  CALL FAILS     │
    │  (429 Quota)    │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  CATCH ERROR    │
    │  IN _generate_  │
    │  _blog_content  │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  CHECK FOR      │
    │  QUOTA ERROR    │
    │  (quota, 429,   │
    │  insufficient)  │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  RETURN         │
    │  "API_QUOTA_    │
    │  ERROR"         │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  SET state.error│
    │  AND BREAK      │
    │  GENERATION     │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  RETURN ERROR   │
    │  TO FRONTEND    │
    │  success: false │
    └─────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                           CONSOLE LOGGING OUTPUT                               │
└─────────────────────────────────────────────────────────────────────────────────┘

    ┌─────────────────┐
    │  PROFILE DATA   │
    │  LOADED         │
    │  (Shows actual  │
    │  user data)     │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  WORDPRESS      │
    │  SITES LOADED   │
    │  (Shows site    │
    │  information)   │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  GENERATION     │
    │  CONTEXT        │
    │  (Shows what    │
    │  data is used)  │
    └─────────┬───────┘
              │
              ▼
    ┌─────────────────┐
    │  GENERATED      │
    │  BLOG CONTENT   │
    │  (Shows final   │
    │  blog details)  │
    └─────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                           KEY FEATURES                                         │
└─────────────────────────────────────────────────────────────────────────────────┘

    ✅ PROFILE-DRIVEN CONTENT
    • Uses actual user business data from database
    • No hardcoded or mock data
    • Personalized for specific business and industry

    ✅ COMPREHENSIVE CONTEXT
    • Business name, industry, target audience
    • Content themes, brand voice, unique value proposition
    • Products/services, business description
    • WordPress site information

    ✅ ERROR HANDLING
    • Detects API quota exceeded
    • Returns proper error messages
    • Stops generation process on errors

    ✅ CONSOLE LOGGING
    • Detailed logging at each step
    • Shows exactly what data is being used
    • Helps debug issues

    ✅ DATABASE INTEGRATION
    • Stores generated blogs in database
    • Links to user and WordPress site
    • Maintains metadata and context

┌─────────────────────────────────────────────────────────────────────────────────┐
│                           CURRENT ISSUES                                       │
└─────────────────────────────────────────────────────────────────────────────────┘

    ❌ API QUOTA EXCEEDED
    • OpenAI API quota needs to be increased
    • Currently blocking blog generation

    ❌ ERROR HANDLING
    • Some error cases not properly handled
    • Frontend not always showing error messages

    ❌ FRONTEND DISPLAY
    • Error messages not always shown to user
    • Success message shown even when no blogs generated

┌─────────────────────────────────────────────────────────────────────────────────┐
│                           NEXT STEPS                                           │
└─────────────────────────────────────────────────────────────────────────────────┘

    1. Fix OpenAI API billing/quota
    2. Improve error handling and user feedback
    3. Add retry mechanisms for API failures
    4. Implement fallback content generation
    5. Test with valid API quota
